import React, { useEffect, useState } from 'react';
import NoResultFound from '@Components/no-result-found/NoResultFound';
import { checkForFalsyValues, downloadFiles } from "@Src/utils/globalUtilities";
import moment from 'moment';
import Tooltip from '@mui/material/Tooltip';
import IconButton from '@mui/material/IconButton';
import './Document.scss';

interface DocumentProps {
    file_name?: string;
    file_type?: string;
    file_date?: string | undefined | Date;
    fileUrl?: string;
    file_iconUrl?: string;
    viewDocumentsInPopUp: (fileInfo: any) => void;
}

const Document: React.FC<DocumentProps> = ({
    file_name,
    file_type,
    file_date,
    file_iconUrl,
    fileUrl,
    viewDocumentsInPopUp
}) => {
    const [changeDisplay, setChangeDisplay] = useState(false);
    const [documentFileName, setDocumentFileName] = useState<string | undefined>();

    useEffect(() => {
        if (fileUrl) {
            const filename = fileUrl.split('/').pop();
            setDocumentFileName(filename?.endsWith('.pdf') ? filename.concat('.pdf') : filename);
        }
    }, [fileUrl]);

    const viewDocumentsFiles = (fileUrl: string = "") => {
        const fileExt = fileUrl.slice(-4).toLowerCase();
        const fileInfo = { isOpen: true, file_url: fileUrl, file_type: fileExt === '.pdf' ? 'pdf' : 'jpg' };
        viewDocumentsInPopUp(fileInfo);
    };

    const renderFileIcon = () => {
        if (!fileUrl) return null;
        const lowerFileUrl = fileUrl.toLowerCase();
        const fileIcons = {
            '.pdf': (
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <path fillRule="evenodd" clipRule="evenodd" d="M8.1999 0H18.8985L27.966 9.45128V27.8341C27.966 30.1369 26.1029 32 23.8081 32H8.1999C5.89706 32 4.034 30.1369 4.034 27.8341V4.1659C4.03396 1.86306 5.89702 0 8.1999 0Z" fill="#E5252A" />
                    <path opacity="0.302" fillRule="evenodd" clipRule="evenodd" d="M18.8905 0V9.37931H27.966L18.8905 0Z" fill="white" />
                    <path d="M8.66364 23.8763V18.0312H11.1504C11.7661 18.0312 12.2539 18.1992 12.6217 18.543C12.9895 18.8788 13.1734 19.3346 13.1734 19.9023C13.1734 20.47 12.9895 20.9258 12.6217 21.2616C12.2539 21.6055 11.7661 21.7734 11.1504 21.7734H10.1589V23.8763H8.66364ZM10.1589 20.502H10.9825C11.2064 20.502 11.3823 20.4541 11.5022 20.3421C11.6222 20.2382 11.6862 20.0942 11.6862 19.9024C11.6862 19.7105 11.6222 19.5665 11.5022 19.4626C11.3823 19.3506 11.2064 19.3027 10.9825 19.3027H10.1589V20.502ZM13.7891 23.8763V18.0312H15.86C16.2678 18.0312 16.6516 18.0872 17.0114 18.2072C17.3713 18.3271 17.6991 18.495 17.987 18.7269C18.2748 18.9508 18.5067 19.2546 18.6746 19.6385C18.8345 20.0223 18.9225 20.4621 18.9225 20.9578C18.9225 21.4456 18.8346 21.8853 18.6746 22.2691C18.5067 22.6529 18.2748 22.9568 17.987 23.1807C17.6991 23.4125 17.3713 23.5804 17.0114 23.7004C16.6516 23.8203 16.2678 23.8763 15.86 23.8763H13.7891ZM15.2523 22.605H15.6841C15.916 22.605 16.1319 22.581 16.3318 22.525C16.5237 22.4691 16.7076 22.3811 16.8835 22.2612C17.0514 22.1412 17.1874 21.9733 17.2833 21.7494C17.3793 21.5255 17.4273 21.2616 17.4273 20.9578C17.4273 20.6459 17.3793 20.3821 17.2833 20.1582C17.1874 19.9343 17.0514 19.7664 16.8835 19.6465C16.7076 19.5265 16.5237 19.4386 16.3318 19.3826C16.1319 19.3266 15.916 19.3026 15.6841 19.3026H15.2523V22.605ZM19.6741 23.8763V18.0312H23.8321V19.3026H21.1694V20.2381H23.2963V21.5015H21.1694V23.8763H19.6741Z" fill="white" />
                </svg>
            ),
            '.doc': (
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <path d="M8.19628 0H18.9032L27.9666 9.45593V27.8372C27.9666 30.1365 26.103 32 23.8038 32H8.19628C5.89699 32 4.03345 30.1364 4.03345 27.8372V4.16283C4.03345 1.86359 5.89699 0 8.19628 0Z" fill="#0263D1" />
                    <path opacity="0.302" fillRule="evenodd" clipRule="evenodd" d="M18.8903 0V9.37826H27.9666L18.8903 0Z" fill="white" />
                    <path d="M7.89862 22.8334V17.536H9.77515C10.1504 17.536 10.4999 17.5921 10.8234 17.6956C11.147 17.8034 11.4403 17.9587 11.7035 18.1658C11.9666 18.3729 12.1737 18.649 12.3247 18.9941C12.4756 19.3392 12.5533 19.7361 12.5533 20.1847C12.5533 20.6333 12.4756 21.0302 12.3247 21.3753C12.1737 21.7204 11.9666 21.9965 11.7035 22.2035C11.4403 22.4106 11.147 22.5659 10.8234 22.6738C10.4999 22.7773 10.1505 22.8334 9.77515 22.8334H7.89862ZM9.22297 21.6816H9.61552C9.8269 21.6816 10.0253 21.6557 10.2022 21.6083C10.3834 21.5565 10.5473 21.4745 10.7026 21.3667C10.8579 21.2588 10.9786 21.1035 11.0649 20.9008C11.1555 20.7023 11.1986 20.4608 11.1986 20.1847C11.1986 19.9086 11.1555 19.667 11.0649 19.4643C10.9786 19.2658 10.8579 19.1105 10.7026 19.0027C10.5473 18.8905 10.3834 18.8129 10.2022 18.7611C10.0253 18.7137 9.8269 18.6878 9.61552 18.6878H9.22297V21.6816ZM15.7671 22.8938C14.969 22.8938 14.309 22.6349 13.787 22.1216C13.2651 21.6083 13.0062 20.9612 13.0062 20.1847C13.0062 19.4082 13.2651 18.7612 13.787 18.2478C14.309 17.7345 14.969 17.4757 15.7671 17.4757C16.5522 17.4757 17.2036 17.7345 17.7256 18.2478C18.2432 18.7612 18.502 19.4083 18.502 20.1847C18.502 20.9612 18.2432 21.6083 17.7256 22.1216C17.2036 22.6349 16.5522 22.8938 15.7671 22.8938ZM14.749 21.302C15.0121 21.5953 15.3486 21.742 15.7584 21.742C16.1682 21.742 16.5004 21.5953 16.7636 21.302C17.0267 21.0043 17.1561 20.6333 17.1561 20.1847C17.1561 19.7361 17.0267 19.365 16.7636 19.0674C16.5004 18.7741 16.1682 18.6274 15.7584 18.6274C15.3486 18.6274 15.0121 18.7741 14.749 19.0674C14.4859 19.365 14.3521 19.7361 14.3521 20.1847C14.3521 20.6333 14.4859 21.0043 14.749 21.302ZM21.6511 22.8938C20.879 22.8938 20.2362 22.6522 19.7272 22.1777C19.2138 21.6989 18.9593 21.0345 18.9593 20.1847C18.9593 19.3392 19.2182 18.6748 19.7358 18.196C20.2578 17.7172 20.8919 17.4756 21.6512 17.4756C22.3371 17.4756 22.8978 17.6438 23.3422 17.9846C23.7822 18.3211 24.0367 18.7697 24.1014 19.3305L22.7641 19.6023C22.7081 19.309 22.5743 19.0717 22.3673 18.8948C22.1602 18.7179 21.9186 18.6274 21.6425 18.6274C21.2629 18.6274 20.948 18.7611 20.6935 19.0329C20.4389 19.3089 20.3095 19.6885 20.3095 20.1846C20.3095 20.6807 20.4389 21.0604 20.6891 21.3321C20.9437 21.6082 21.2586 21.742 21.6425 21.742C21.9185 21.742 22.1558 21.6643 22.35 21.509C22.5441 21.3537 22.6649 21.1467 22.7166 20.8878L24.0841 21.1984C23.959 21.7334 23.6829 22.1475 23.2515 22.4451C22.8245 22.7428 22.2896 22.8938 21.6511 22.8938Z" fill="white" />
                </svg>
            ),
            '.jpg': (
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <path fillRule="evenodd" clipRule="evenodd" d="M8.1996 0H18.9023L27.9679 9.45791V27.8326C27.9679 30.1328 26.1006 32 23.8004 32H8.1996C5.89939 32 4.03217 30.1328 4.03217 27.8326V4.16744C4.03217 1.86723 5.89939 0 8.1996 0Z" fill="#0AC963" />
                    <path opacity="0.302" fillRule="evenodd" clipRule="evenodd" d="M18.8889 0V9.37673H27.9679L18.8889 0Z" fill="white" />
                    <path fillRule="evenodd" clipRule="evenodd" d="M20.066 15.9932H11.9341C11.3252 15.9932 10.8245 16.4938 10.8245 17.1027V22.2714C10.8245 22.8803 11.3252 23.3809 11.9341 23.3809H20.066C20.6748 23.3809 21.162 22.8803 21.162 22.2714V17.1027C21.162 16.4938 20.6749 15.9932 20.066 15.9932ZM14.1531 17.3868C14.8161 17.3868 15.3438 17.928 15.3438 18.5775C15.3438 19.2405 14.8161 19.7817 14.1531 19.7817C13.4901 19.7817 12.9489 19.2405 12.9489 18.5775C12.9489 17.928 13.4901 17.3868 14.1531 17.3868ZM20.4313 22.2714C20.4313 22.4744 20.2689 22.6502 20.066 22.6502H11.9341C11.7311 22.6502 11.5687 22.4744 11.5687 22.2714V22.0549L13.0435 20.5801L14.2613 21.7979C14.4101 21.9467 14.6402 21.9467 14.789 21.7979L17.8469 18.7399L20.4313 21.3243V22.2714Z" fill="white" />
                </svg>
            ),
            '.jpeg': (
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <path fillRule="evenodd" clipRule="evenodd" d="M8.1996 0H18.9023L27.9679 9.45791V27.8326C27.9679 30.1328 26.1006 32 23.8004 32H8.1996C5.89939 32 4.03217 30.1328 4.03217 27.8326V4.16744C4.03217 1.86723 5.89939 0 8.1996 0Z" fill="#0AC963" />
                    <path opacity="0.302" fillRule="evenodd" clipRule="evenodd" d="M18.8889 0V9.37673H27.9679L18.8889 0Z" fill="white" />
                    <path fillRule="evenodd" clipRule="evenodd" d="M20.066 15.9932H11.9341C11.3252 15.9932 10.8245 16.4938 10.8245 17.1027V22.2714C10.8245 22.8803 11.3252 23.3809 11.9341 23.3809H20.066C20.6748 23.3809 21.162 22.8803 21.162 22.2714V17.1027C21.162 16.4938 20.6749 15.9932 20.066 15.9932ZM14.1531 17.3868C14.8161 17.3868 15.3438 17.928 15.3438 18.5775C15.3438 19.2405 14.8161 19.7817 14.1531 19.7817C13.4901 19.7817 12.9489 19.2405 12.9489 18.5775C12.9489 17.928 13.4901 17.3868 14.1531 17.3868ZM20.4313 22.2714C20.4313 22.4744 20.2689 22.6502 20.066 22.6502H11.9341C11.7311 22.6502 11.5687 22.4744 11.5687 22.2714V22.0549L13.0435 20.5801L14.2613 21.7979C14.4101 21.9467 14.6402 21.9467 14.789 21.7979L17.8469 18.7399L20.4313 21.3243V22.2714Z" fill="white" />
                </svg>
            ),
            '.png': (
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <path fillRule="evenodd" clipRule="evenodd" d="M8.1996 0H18.9023L27.9679 9.45791V27.8326C27.9679 30.1328 26.1006 32 23.8004 32H8.1996C5.89939 32 4.03217 30.1328 4.03217 27.8326V4.16744C4.03217 1.86723 5.89939 0 8.1996 0Z" fill="#0AC963" />
                    <path opacity="0.302" fillRule="evenodd" clipRule="evenodd" d="M18.8889 0V9.37673H27.9679L18.8889 0Z" fill="white" />
                    <path fillRule="evenodd" clipRule="evenodd" d="M20.066 15.9932H11.9341C11.3252 15.9932 10.8245 16.4938 10.8245 17.1027V22.2714C10.8245 22.8803 11.3252 23.3809 11.9341 23.3809H20.066C20.6748 23.3809 21.162 22.8803 21.162 22.2714V17.1027C21.162 16.4938 20.6749 15.9932 20.066 15.9932ZM14.1531 17.3868C14.8161 17.3868 15.3438 17.928 15.3438 18.5775C15.3438 19.2405 14.8161 19.7817 14.1531 19.7817C13.4901 19.7817 12.9489 19.2405 12.9489 18.5775C12.9489 17.928 13.4901 17.3868 14.1531 17.3868ZM20.4313 22.2714C20.4313 22.4744 20.2689 22.6502 20.066 22.6502H11.9341C11.7311 22.6502 11.5687 22.4744 11.5687 22.2714V22.0549L13.0435 20.5801L14.2613 21.7979C14.4101 21.9467 14.6402 21.9467 14.789 21.7979L17.8469 18.7399L20.4313 21.3243V22.2714Z" fill="white" />
                </svg>
            ),
            '.webp': (
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="36" viewBox="0 0 24 24">
                    <path fill="#A4C639" d="M12 1c-1.1 0-2 .9-2 2v2h4V3c0-1.1-.9-2-2-2zm7 4v14c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2zm-2 14V9H9v10h8z" />
                </svg>
            ),
            '.csv': (
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="36" viewBox="0 0 24 24">
                    <path fill="#FFD700" d="M7 4h3v3H7V4zm5 0h3v3h-3V4zm3 9h-3v3h3v-3zm0-5h-3v3h3V8zm-8 0H4v12h3v-1H5V9h3V8H4V7h3V4H2v16h17v-2H4V6h12v3h2V4c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7h-2z" />
                </svg>
            ),
            '.svg': (
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32" height="32">
                    <path fill="#FF0000" d="M2 2v20h20V2H2zm18 18H4V4h16v16z" />
                </svg>
            )
        };

        const fileExtension = Object.keys(fileIcons).find((ext) => lowerFileUrl.endsWith(ext)) || '';
        return fileIcons[fileExtension as keyof typeof fileIcons] || (
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none">
                <path fillRule="evenodd" clipRule="evenodd" d="M8.1999 0H18.8985L27.966 9.45128V27.8341C27.966 30.1369 26.1029 32 23.8081 32H8.1999C5.89706 32 4.034 30.1369 4.034 27.8341V4.1659C4.03396 1.86306 5.89702 0 8.1999 0Z" fill="#E5252A" />
                <path opacity="0.302" fillRule="evenodd" clipRule="evenodd" d="M18.8905 0V9.37931H27.966L18.8905 0Z" fill="white" />
                <path d="M8.66364 23.8763V18.0312H11.1504C11.7661 18.0312 12.2539 18.1992 12.6217 18.543C12.9895 18.8788 13.1734 19.3346 13.1734 19.9023C13.1734 20.47 12.9895 20.9258 12.6217 21.2616C12.2539 21.6055 11.7661 21.7734 11.1504 21.7734H10.1589V23.8763H8.66364ZM10.1589 20.502H10.9825C11.2064 20.502 11.3823 20.4541 11.5022 20.3421C11.6222 20.2382 11.6862 20.0942 11.6862 19.9024C11.6862 19.7105 11.6222 19.5665 11.5022 19.4626C11.3823 19.3506 11.2064 19.3027 10.9825 19.3027H10.1589V20.502ZM13.7891 23.8763V18.0312H15.86C16.2678 18.0312 16.6516 18.0872 17.0114 18.2072C17.3713 18.3271 17.6991 18.495 17.987 18.7269C18.2748 18.9508 18.5067 19.2546 18.6746 19.6385C18.8345 20.0223 18.9225 20.4621 18.9225 20.9578C18.9225 21.4456 18.8346 21.8853 18.6746 22.2691C18.5067 22.6529 18.2748 22.9568 17.987 23.1807C17.6991 23.4125 17.3713 23.5804 17.0114 23.7004C16.6516 23.8203 16.2678 23.8763 15.86 23.8763H13.7891ZM15.2523 22.605H15.6841C15.916 22.605 16.1319 22.581 16.3318 22.525C16.5237 22.4691 16.7076 22.3811 16.8835 22.2612C17.0514 22.1412 17.1874 21.9733 17.2833 21.7494C17.3793 21.5255 17.4273 21.2616 17.4273 20.9578C17.4273 20.6459 17.3793 20.3821 17.2833 20.1582C17.1874 19.9343 17.0514 19.7664 16.8835 19.6465C16.7076 19.5265 16.5237 19.4386 16.3318 19.3826C16.1319 19.3266 15.916 19.3026 15.6841 19.3026H15.2523V22.605ZM19.6741 23.8763V18.0312H23.8321V19.3026H21.1694V20.2381H23.2963V21.5015H21.1694V23.8763H19.6741Z" fill="white" />
            </svg>
        );
    };

    return (
        <>
            {fileUrl ? (
                <div
                    className={`tw-flex tw-items-center tw-justify-between tw-p-1 tw-rounded-md ${changeDisplay ? 'tw-bg-[#F3F5F6]' : ''}`}
                    onMouseEnter={() => setChangeDisplay(true)}
                    onMouseLeave={() => setChangeDisplay(false)}
                >
                    <div className='tw-flex tw-items-center tw-gap-2'>
                        <div className='file-icon'>{renderFileIcon()}</div>
                        <div className='file-name'>
                            <div>
                                <p className='fs13 tw-font-medium text-pri-all'>{documentFileName}</p>
                                <p className='fs13 tw-text-[#989FAE]'>added on {checkForFalsyValues(moment(file_date)).format('DD/MM/YYYY')}</p>
                            </div>
                        </div>
                    </div>
                    {changeDisplay && (
                        <div className='file-commands tw-pr-2'>
                            <div className='tw-flex tw-items-center'>
                                <Tooltip title="View" arrow placement='top' className='custom-tooltip'>
                                    <IconButton aria-label="" onClick={() => viewDocumentsFiles(fileUrl)}>
                                        <img src="/images/view-icon.svg" alt="" />
                                    </IconButton>
                                </Tooltip>
                                <Tooltip title="Download" arrow placement='top'>
                                    <IconButton aria-label="" onClick={() => downloadFiles(fileUrl, documentFileName)}>
                                        <img src="/images/download-icon.svg" alt="" />
                                    </IconButton>
                                </Tooltip>
                            </div>
                        </div>
                    )}
                </div>
            ) : (
                <div className='tw-mt-8'>
                    <NoResultFound description='We cannot find the item you are searching for' />
                </div>
            )}
        </>
    );
};

export default Document;